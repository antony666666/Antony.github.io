<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"braveantony.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Kubernetes-Objects認識 K8S 叢集物件  CustomResourceDefinitions ，自定義 K8s 的物件  K8S Object Short-names1234567891011121314151617181920Short name       Full namecsr      	  certificatesigningrequestscm">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes-Objects">
<meta property="og:url" content="https://braveantony.github.io/Kubernetes-Objects/index.html">
<meta property="og:site_name" content="Antony 的學習筆記">
<meta property="og:description" content="Kubernetes-Objects認識 K8S 叢集物件  CustomResourceDefinitions ，自定義 K8s 的物件  K8S Object Short-names1234567891011121314151617181920Short name       Full namecsr      	  certificatesigningrequestscm">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/vVVHNS6.png">
<meta property="og:image" content="https://i.imgur.com/ji3dIzS.png">
<meta property="og:image" content="https://i.imgur.com/ud14Cy4.png">
<meta property="og:image" content="https://i.imgur.com/PK4jp46.png">
<meta property="article:published_time" content="2022-08-27T22:51:02.000Z">
<meta property="article:modified_time" content="2023-05-07T10:14:22.178Z">
<meta property="article:author" content="Antony Cehn">
<meta property="article:tag" content="系統工程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/vVVHNS6.png">

<link rel="canonical" href="https://braveantony.github.io/Kubernetes-Objects/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Kubernetes-Objects | Antony 的學習筆記</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Antony 的學習筆記</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">這個網站將紀錄持續記錄我學習到各種知識的筆記</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://braveantony.github.io/Kubernetes-Objects/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Antony Cehn">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Antony 的學習筆記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kubernetes-Objects
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-28 06:51:02" itemprop="dateCreated datePublished" datetime="2022-08-28T06:51:02+08:00">2022-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-07 18:14:22" itemprop="dateModified" datetime="2023-05-07T18:14:22+08:00">2023-05-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Kubernetes-Objects"><a href="#Kubernetes-Objects" class="headerlink" title="Kubernetes-Objects"></a>Kubernetes-Objects</h1><h2 id="認識-K8S-叢集物件"><a href="#認識-K8S-叢集物件" class="headerlink" title="認識 K8S 叢集物件"></a>認識 K8S 叢集物件</h2><p><img src="https://i.imgur.com/vVVHNS6.png"></p>
<ul>
<li><code>CustomResourceDefinitions</code> ，自定義 K8s 的物件</li>
</ul>
<h2 id="K8S-Object-Short-names"><a href="#K8S-Object-Short-names" class="headerlink" title="K8S Object Short-names"></a>K8S Object Short-names</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Short name       Full name</span><br><span class="line">csr      	  certificatesigningrequests</span><br><span class="line">cm	          configmaps</span><br><span class="line">ds	          daemonsets</span><br><span class="line">deploy	          deployments</span><br><span class="line">ep	          endpoints</span><br><span class="line">ev	          events</span><br><span class="line">hpa      	  horizontalpodautoscalers</span><br><span class="line">ing	          ingresses</span><br><span class="line">ns	          namespaces</span><br><span class="line">pvc	          persistentvolumeclaims</span><br><span class="line">svc	          services</span><br><span class="line">pv	          persistentvolumes</span><br><span class="line">po	          pods</span><br><span class="line">pdb	          poddisruptionbudgets</span><br><span class="line">psp	          podsecuritypolicies</span><br><span class="line">rs	          replicasets</span><br><span class="line">rc	          replicationcontrollers</span><br><span class="line">quota	          resourcequotas</span><br><span class="line">sa	          serviceaccounts</span><br></pre></td></tr></table></figure>

<h1 id="建立-Kubernetes-POD"><a href="#建立-Kubernetes-POD" class="headerlink" title="建立 Kubernetes POD"></a>建立 Kubernetes POD</h1><p>:::spoiler Node &amp; POD 示意圖</p>
<p><img src="https://i.imgur.com/ji3dIzS.png"></p>
<p>:::</p>
<ul>
<li>volime 儲存體 ，供 pod 使用</li>
<li>一個 pod 可以跑很多台 Container ，代表可以 run 很多 企業要用的 Application</li>
</ul>
<h2 id="認識-Kubernetes-Pod"><a href="#認識-Kubernetes-Pod" class="headerlink" title="認識 Kubernetes Pod"></a>認識 Kubernetes Pod</h2><ul>
<li><font color=red><strong>Pods are not intended to live long.</strong></font><ul>
<li>pod 很容易領便當</li>
<li>K8s 內定，node 主機重開，裡面的 pod 會浴火重生</li>
</ul>
</li>
<li>This group of containers would share storage, Linux namespaces, cgroups, IP addresses.<ul>
<li>pod 中的 Container 會共享 volume , Linux Namespaces, cgroups, IP 位址</li>
</ul>
</li>
</ul>
<h2 id="Single-Container-Pod-建立與連接"><a href="#Single-Container-Pod-建立與連接" class="headerlink" title="Single Container Pod 建立與連接"></a>Single Container Pod 建立與連接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 Windows 系統的 cmd 視窗, 執行以下命令</span></span><br><span class="line">$ ssh bigred@&lt;alp.m1 IP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 從 1.18 這個版本開始, 下面命令只會產生 pod, </span></span><br><span class="line"><span class="comment"># 不再會產生 deployment object 及 replicaset controller.</span></span><br><span class="line"><span class="comment"># --image= ，等號右邊的格式為 image 網站/帳號/image 名稱</span></span><br><span class="line">$ kubectl run a1 --image-pull-policy IfNotPresent --image=quay.io/cloudwalker/alpine.derby</span><br><span class="line">pod/a1 created</span><br><span class="line"></span><br><span class="line"><span class="comment"># STATUS 的 ContainerCreating，</span></span><br><span class="line"><span class="comment"># 代表 Container 正在被 CRI-O 透過 pull 命令到網路上下載 Container 需要的 image</span></span><br><span class="line">$ kg pods -o wide</span><br><span class="line">NAME   READY   STATUS              RESTARTS   AGE   IP       NODE   NOMINATED NODE   READINESS GATES</span><br><span class="line">a1     0/1     ContainerCreating   0          64s   &lt;none&gt;   w1     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把 pod 的 IP 位址丟到一個變數</span></span><br><span class="line">$ podip=$(kg pods -o wide | grep -e <span class="string">&quot;^a1 &quot;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27; &#x27;</span> -f6)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 檢查是否符合預期</span></span><br><span class="line">$ curl http://<span class="variable">$podip</span>:8888</span><br><span class="line">&lt;h1&gt;Welcome to Spring Boot&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">$ curl http://<span class="variable">$podip</span>:8888/hostname</span><br><span class="line">Hostname : a1</span><br></pre></td></tr></table></figure>


<p>進入a1 pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl exec -it a1 -- bash</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>--</code>分隔符號，後面放的是 pod 要執行的程式<br>連線的動作會經過加密，安全等級不輸 SSH</p>
</blockquote>
<p>檢查有無啟動pid 的 namespace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ps aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.0   2180  1672 ?        Ss   06:29   0:00 bash -c /derby/app/startup</span><br><span class="line">root          2  1.5  2.5 3496804 207136 ?      Sl   06:29   0:11 java -jar -Dderby.system.home=/derby/db /derby/app/dt-0.0.1-SNAPSHOT.war</span><br><span class="line">root         44  0.0  0.0   2312  1696 pts/0    Ss   06:40   0:00 bash</span><br><span class="line">root         45  0.0  0.0   1624   520 pts/0    R+   06:41   0:00 ps aux</span><br></pre></td></tr></table></figure>
<p>有！</p>
<p>在 pod a1 裡搞破壞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -r /bin/*</span><br><span class="line">bash-4.4# ls -al /bin/</span><br><span class="line">bash: ls: command not found</span><br><span class="line">bash-4.4# exit</span><br><span class="line">exit</span><br><span class="line">command terminated with exit code 127</span><br><span class="line"></span><br><span class="line">bigred@m1:~$ kubectl exec -it a1 -- bash</span><br><span class="line">2022-05-31T06:44:14.000679204Z: 2022-05-31T06:44:14.000679086Z: executable file `bash` not found in $PATH: No such file or directory</span><br></pre></td></tr></table></figure>

<p>檢查 node 本機的 &#x2F;bin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bigred@m1:~$ ls -al /bin/</span><br></pre></td></tr></table></figure>

<p>可以發現沒被破壞</p>
<p>刪除pod a1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete pod a1</span><br></pre></td></tr></table></figure>


<hr>
<h2 id="Single-Container-Pod-自動重新建立"><a href="#Single-Container-Pod-自動重新建立" class="headerlink" title="Single Container Pod 自動重新建立"></a>Single Container Pod 自動重新建立</h2><p>重新建立並執行 a1 pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run a1 --image=quay.io/cloudwalker/alpine -- sleep 15</span><br></pre></td></tr></table></figure>

<p>當 pod 的狀態呈現 Compelted 時， K8s 會將 pod 浴火重生，讓 pod 再次 runnning</p>
<p>:::success<br>監控 pod a1 的狀態</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods a1 --watch</span><br></pre></td></tr></table></figure>

<p>:::spoiler 結果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NAME   READY   STATUS             RESTARTS      AGE</span><br><span class="line">a1     0/1     CrashLoopBackOff   4 (31s ago)   3m24s</span><br><span class="line">a1     1/1     Running            5 (86s ago)   4m19s</span><br><span class="line">a1     0/1     Completed          5 (101s ago)   4m34s</span><br><span class="line">a1     0/1     CrashLoopBackOff   5 (16s ago)    4m49s</span><br><span class="line">...以下省略</span><br></pre></td></tr></table></figure>
<p><font color=red>當STATUS 出現<code>CrashLoopBackOff</code> ，代表 pod 正在不斷被重啟。<br>    重啟 6 次後, 會將重啟時間拉長, 繼續重啟</font><br>:::</p>
<p>刪除 pod a1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete pod  a1</span><br></pre></td></tr></table></figure>


<hr>
<h2 id="K8S-Node-系統重新啟動"><a href="#K8S-Node-系統重新啟動" class="headerlink" title="K8S Node 系統重新啟動"></a>K8S Node 系統重新啟動</h2><p>:::success</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立並執行 pod a1</span></span><br><span class="line">$ kubectl run a1 --image=quay.io/ict39/alpine.derby </span><br><span class="line">pod/a1 created</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 pod a1 的 ip 位址和所在主機</span></span><br><span class="line">$ kubectl get pod a1 -o wide | grep a1</span><br><span class="line">a1     1/1     Running   0          36s   10.244.2.10   w2     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 將 pod a1 所在主機重新開機</span></span><br><span class="line">$ ssh w2 sudo reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 檢查 pod a1 的狀態</span></span><br><span class="line">$ kubectl get pod a1 -o wide | grep a1</span><br><span class="line">a1     0/1     ContainerCreating   1          2m23s   &lt;none&gt;   w2     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次檢查 pod a1 的狀態</span></span><br><span class="line">$ kubectl get pod a1 -o wide | grep a1</span><br><span class="line">a1     1/1     Running   1          2m35s   10.244.2.11   w2     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 pod a1</span></span><br><span class="line">$ kubectl delete pod  a1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><font color=red><strong>結論： pod a1 的 IP 位址會改變, 這是因爲 node 重啟時會產生一個新 Pod</strong></font><br>:::</p>
<hr>
<h2 id="Single-Container-Pod-永不重啟"><a href="#Single-Container-Pod-永不重啟" class="headerlink" title="Single Container Pod 永不重啟"></a>Single Container Pod 永不重啟</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run a1 --restart=<span class="string">&#x27;Never&#x27;</span>  --image=quay.io/cloudwalker/alpine -- <span class="built_in">sleep</span> 15</span><br><span class="line">pod/a1 created</span><br><span class="line"></span><br><span class="line">$ kubectl get pods </span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class="line">a1        1/1        Running   0                 10s</span><br><span class="line"></span><br><span class="line">$ kubectl get pods </span><br><span class="line">NAME   READY   STATUS       RESTARTS   AGE</span><br><span class="line">a1        0/1       Completed   0                32s</span><br><span class="line"></span><br><span class="line">$ kubectl delete pod a1</span><br><span class="line">pod <span class="string">&quot;a1&quot;</span> deleted</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h2 id="建立-Share-PID-Namespace-Pod"><a href="#建立-Share-PID-Namespace-Pod" class="headerlink" title="建立 Share PID Namespace Pod"></a>建立 Share PID Namespace Pod</h2><p>先建立 wulin 工作目錄</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/wulin/yaml; cd ~/wulin</span><br></pre></td></tr></table></figure>

<p>:::success<br>宣告 yaml&#x2F;yml 檔<br><font color=red><strong>超級注意！縮編格式一定要對！不然絕對噴 Error 給你看!</strong></font></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: sharepid</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  shareProcessNamespace: true</span></span><br><span class="line"><span class="string">  hostname: xyz </span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: derby</span></span><br><span class="line"><span class="string">    image: quay.io/cloudwalker/alpine.derby</span></span><br><span class="line"><span class="string">    imagePullPolicy: Always</span></span><br><span class="line"><span class="string">  - name: shell</span></span><br><span class="line"><span class="string">    image: quay.io/cloudwalker/alpine</span></span><br><span class="line"><span class="string">    imagePullPolicy: IfNotPresent</span></span><br><span class="line"><span class="string">    tty: true  &#x27;</span> &gt; yaml/sharepid.yml</span><br></pre></td></tr></table></figure>
<ul>
<li><code>kind</code> ， 宣告要產生什麼</li>
<li><code>metadata</code> ，會宣告 pod 的名稱</li>
<li><code>spec</code> ， pod 的結構說明<ul>
<li>有兩個 image 代表有兩台 Container ， 名字分別是：derby 和 shell ，他們共用 hostname: xyz</li>
<li><code>shareProcessNamespace: true</code> ，兩台 Container 用同一個 pid 的 Namespace</li>
<li><code>tty: true</code> ，給一個虛擬終端機，因為 <code>quay.io/cloudwalker/alpine</code> 這個 image 內定執行的命令是 sh ，所以一定要有一台虛擬終端機</li>
<li><code>imagePullPolicy: Always</code> ，代表每次都要下載 image</li>
<li><code>imagePullPolicy: IfNotPresent</code> ， 代表沒有 image 再下載</li>
<li><font color=red>如果企業無法上網，就要宣告<code>imagePullPolicy: Never</code></font></li>
</ul>
</li>
<li>最後要輸出的檔名可以<code>*.yaml</code> 或是 <code>*.yml</code> 都可以。<br>:::</li>
</ul>
<p>k8s 標準的運作，透過 yaml 檔作業</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f yaml/sharepid.yml </span><br></pre></td></tr></table></figure>



<hr>
<h2 id="檢視-Pod-內部資訊"><a href="#檢視-Pod-內部資訊" class="headerlink" title="檢視 Pod 內部資訊"></a>檢視 Pod 內部資訊</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod/sharepid -o jsonpath=&#x27;&#123;.spec.containers[*].name&#125;&#x27;;echo &quot;&quot;</span><br><span class="line">derby shell</span><br></pre></td></tr></table></figure>


<p>相同電腦名稱</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl exec sharepid  -c shell -- hostname; kubectl exec sharepid  -c derby -- hostname</span><br><span class="line">xyz</span><br><span class="line">xyz</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-c 指定Container</p>
</blockquote>
<p>共用 IP 位址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl exec sharepid  -c shell -- hostname -i; kubectl exec sharepid  -c derby -- hostname -i</span><br><span class="line">10.244.1.4</span><br><span class="line">10.244.1.4</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="檢測-Pod-內部-Process"><a href="#檢測-Pod-內部-Process" class="headerlink" title="檢測 Pod 內部 Process"></a>檢測 Pod 內部 Process</h2><p>登入 sharepid 中的 shell container</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl exec -it sharepid  -c shell -- sh</span><br><span class="line">/ # whoami</span><br><span class="line">root</span><br><span class="line">/ # apk add curl</span><br><span class="line">.......</span><br><span class="line">/ # curl http://localhost:8888/hostname</span><br><span class="line">Hostname : xyz</span><br></pre></td></tr></table></figure>
<blockquote>
<p>當我們透過localhost來連接不同的 Container 時，會更有效率，速度接近記憶體的速度。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/ # ps aux</span><br><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 /pause</span><br><span class="line">    6 root      0:00 bash -c /derby/app/startup</span><br><span class="line">   11 root      0:18 java -jar -Dderby.system.home=/derby/db /derby/app/dt-0.0.1-SNAPSHOT.war</span><br><span class="line">   53 root      0:00 /bin/sh</span><br><span class="line">   ...........</span><br><span class="line"></span><br><span class="line">/ # kill -9 1          無法 強制關閉 PID 1</span><br><span class="line">/ # kill -15 1        可以 正常關閉 PID 1</span><br><span class="line">/ # command terminated with exit code 137</span><br></pre></td></tr></table></figure>

<blockquote>
<p>K8s 中所有的 pod 一啟動一定會產生 &#x2F;pause 這台 Container ，裡面跑的程式是 sleep （睡一輩子）站在資安的角度：全球最安全的命令，老師翻成中文：睡夢羅漢</p>
</blockquote>
<h2 id="更多-POD-設定"><a href="#更多-POD-設定" class="headerlink" title="更多 POD 設定"></a>更多 POD 設定</h2><p>:::success</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: twoc</span></span><br><span class="line"><span class="string">  annotations:</span></span><br><span class="line"><span class="string">    kubectl.kubernetes.io/default-container: &quot;shell&quot;</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  shareProcessNamespace: false</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: derby</span></span><br><span class="line"><span class="string">    image: quay.io/cloudwalker/alpine.derby</span></span><br><span class="line"><span class="string">    imagePullPolicy: Never</span></span><br><span class="line"><span class="string">  - name: shell</span></span><br><span class="line"><span class="string">    image: quay.io/cloudwalker/busybox</span></span><br><span class="line"><span class="string">    command:</span></span><br><span class="line"><span class="string">      - sleep</span></span><br><span class="line"><span class="string">      - &quot;60&quot;</span></span><br><span class="line"><span class="string">  restartPolicy: Never&#x27;</span>&gt; yaml/twoc.yml</span><br></pre></td></tr></table></figure>
<ul>
<li>shareProcessNamespace: false ，如果不宣告，內定是 false。</li>
<li>restartPolicy: Never ，設定 pod 永不重啟。<br>:::</li>
</ul>
<p>建立 pod </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f yaml/twoc.yml</span><br><span class="line">pod/twoc created</span><br></pre></td></tr></table></figure>

<p>檢查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kg pods -o wide</span><br><span class="line">NAME       READY   STATUS              RESTARTS       AGE   IP           NODE   NOMINATED NODE   READINESS GATES</span><br><span class="line">sharepid   2/2     Running             2 (6m4s ago)   32m   10.244.1.5   w1     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">twoc       1/2     ErrImageNeverPull   0              59s   10.244.2.6   w2     &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>發現 w2 的 node 沒有 derby Container 的 image</p>
<p>修改yaml 檔</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nano yaml/twoc.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="DNS-for-Service"><a href="#DNS-for-Service" class="headerlink" title="DNS for Service"></a>DNS for Service</h1><p>取得 K8S 叢集的 DNS IP 位址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kube-system get svc</span><br><span class="line">NAME       TYPE        CLUSTER-IP  EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">kube-dns   ClusterIP  10.98.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP  24h</span><br><span class="line"></span><br><span class="line">$ kubectl describe service kube-dns -n kube-system</span><br><span class="line">.........</span><br><span class="line">IP:                10.98.0.10</span><br><span class="line">IPs:               10.98.0.10</span><br><span class="line">Port:              dns  53/UDP</span><br><span class="line">TargetPort:        53/UDP</span><br><span class="line">Endpoints:         10.244.0.6:53,10.244.0.7:53</span><br><span class="line">Port:              dns-tcp  53/TCP</span><br><span class="line">TargetPort:        53/TCP</span><br><span class="line">Endpoints:         10.244.0.6:53,10.244.0.7:53</span><br><span class="line">Port:              metrics  9153/TCP</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">$ kubectl get pods -n kube-system -o wide | grep coredns</span><br><span class="line">coredns-78fcd69978-5v6cd     1/1     Running   2          5d3h   10.244.0.6      m1     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">coredns-78fcd69978-j4z9r     1/1     Running   2          5d3h   10.244.0.7      m1     &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>kube-dns</code> ，它的 IP 位址會固定在 <code>&lt;network_id&gt;.10</code> ，只有 network_id 可以自己設，預設尾數是 10 ，開的 port : 53</li>
<li>透過 <code>kubectl describe</code> 看 <code>kube-dns</code> 詳細的資訊，可以看到 <code>Endpoints:</code> 有兩個 IP 位址，代表後面有兩個 pod 在運作</li>
<li>因 pod 浴火重生 IP 位址可能會發生變化，只有 K8S 的服務會鎖在一個 IP 位址，透過 <code>Selector</code> 來抓到對應的 pod<ul>
<li>服務不會浴火重生，它只是一個儲存在 etcd 裡面的資料區塊，記錄著自己的 IP 位址，及自己真正在運作的 pod 是誰，還有紀錄整個 K8S pod 的 IP 位址及它們的 domain name</li>
</ul>
</li>
</ul>
<p><img src="https://i.imgur.com/ud14Cy4.png"></p>
<ul>
<li>當 K8S 內部的 pod 要上網時， <code>kube-dns</code> 會提供 <strong>名稱解析的服務</strong>，讓我們的 pod 得到要上網的 IP 位址。</li>
<li>當我們建立一個 mysrv 的 service ，這時候他會去和 <code>kube-dns</code> 註冊自己的網址和對應的 IP 位址 ( A record )</li>
</ul>
<p><img src="https://i.imgur.com/PK4jp46.png"></p>
<ul>
<li>無頭服務 ( <code>headless</code> ) 的特性 : service 本身不會有 IP 位址，他一樣會去跟 <code>kube-dns</code> 註冊，不過註冊的資訊會有 pod 的名字及 pod 的 IP 位址 (以上是老師的小秘笈)<ul>
<li>標準的作法是 ，他一樣會去跟 <code>kube-dns</code> 註冊，註冊的資訊是自己 service 本身的名字及對應 pod 的 IP 位址</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run d1 -it --image=quay.io/cloudwalker/alpine</span><br><span class="line">If you dont see a command prompt, try pressing enter.</span><br><span class="line">/ # cat /etc/resolv.conf</span><br><span class="line">search default.svc.k8s.io svc.k8s.io k8s.io localdomain</span><br><span class="line">nameserver 10.98.0.10</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line">/ # ping www.hinet.net</span><br><span class="line">PING www.hinet.net (203.66.32.110): 56 data bytes</span><br><span class="line"></span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>

<p><strong>DNS for Service</strong></p>
<p>編輯 yaml 檔</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nano yaml/service-dns.yaml</span><br></pre></td></tr></table></figure>


<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">k8s-nginx</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">k8s-nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">k8s-nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">quay.io/cloudwalker/nginx</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">k8s-nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-headless</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">k8s-nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<p><strong>透過 <code>kubectl create</code> 產生 yaml 檔中的物件(包含 : deployment, svc-cluster, svc-headless)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f yaml/service-dns.yaml</span><br></pre></td></tr></table></figure>

<p>檢查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ kg all</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/k8s-nginx-56975f8f86-f49nr   1/1     Running   0          4m40s</span><br><span class="line">pod/k8s-nginx-56975f8f86-hf4zh   1/1     Running   0          4m40s</span><br><span class="line">pod/k8s-nginx-56975f8f86-qk727   1/1     Running   0          4m40s</span><br><span class="line"></span><br><span class="line">NAME                   TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">service/kubernetes     ClusterIP   10.98.0.1     &lt;none&gt;        443/TCP   17d</span><br><span class="line">service/svc-cluster    ClusterIP   10.98.0.179   &lt;none&gt;        80/TCP    4m40s</span><br><span class="line">service/svc-headless   ClusterIP   None          &lt;none&gt;        80/TCP    4m40s</span><br><span class="line"></span><br><span class="line">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/k8s-nginx   3/3     3            3           4m40s</span><br><span class="line"></span><br><span class="line">NAME                                   DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/k8s-nginx-56975f8f86   3         3         3       4m40s</span><br></pre></td></tr></table></figure>

<p>檢視 Service endpoints，當前的服務用的是相同的 pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get endpoints svc-cluster</span><br><span class="line">NAME          ENDPOINTS                                      AGE</span><br><span class="line">svc-cluster   10.244.1.35:80,10.244.2.35:80,10.244.2.36:80   8m25s</span><br><span class="line"></span><br><span class="line">$ kubectl get endpoints svc-headless</span><br><span class="line">NAME           ENDPOINTS                                      AGE</span><br><span class="line">svc-headless   10.244.1.35:80,10.244.2.35:80,10.244.2.36:80   8m31s</span><br></pre></td></tr></table></figure>

<p><strong>查詢 Service IP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup</span><br><span class="line">&gt; server 10.98.0.10</span><br><span class="line">Default server: 10.98.0.10</span><br><span class="line">Address: 10.98.0.10#53</span><br><span class="line">&gt; svc-headless.default.svc.k8s.org</span><br><span class="line">Server:         10.98.0.10</span><br><span class="line">Address:        10.98.0.10#53</span><br><span class="line"></span><br><span class="line">Name:   svc-headless.default.svc.k8s.org</span><br><span class="line">Address: 10.244.1.35</span><br><span class="line">Name:   svc-headless.default.svc.k8s.org</span><br><span class="line">Address: 10.244.2.35</span><br><span class="line">Name:   svc-headless.default.svc.k8s.org</span><br><span class="line">Address: 10.244.2.36</span><br><span class="line"></span><br><span class="line">&gt; svc-cluster.default.svc.k8s.org</span><br><span class="line">Server:		10.96.0.10</span><br><span class="line">Address:	10.96.0.10#53</span><br><span class="line"></span><br><span class="line">Name:   svc-cluster.default.svc.k8s.org</span><br><span class="line">Address: 10.98.0.3</span><br><span class="line">&gt; exit</span><br></pre></td></tr></table></figure>

<ul>
<li>透過 <code>nslookup</code> ，設定 <code>DNS server</code> 是 <code>10.98.0.10</code> (Kube-dns) 後，來檢視我們建立的服務 dns 資訊</li>
<li><code>svc-headless.default.svc.k8s.org</code> <ul>
<li>名字的組成 : <code>服務名稱.服務所在的namespace.svc.k8s.org</code></li>
<li><code>svc</code> ，代表是 service 的紀錄</li>
<li><code>k8s.org</code> ，是我們在 init K8S 的時候設定的</li>
</ul>
</li>
<li><code>A record</code>，由一個 <code>Name</code> + 一個 <code>IP Address</code> 組成</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; kube-dns.kube-system.svc.k8s.org</span><br><span class="line">Server:         10.98.0.10</span><br><span class="line">Address:        10.98.0.10#53</span><br><span class="line"></span><br><span class="line">Name:   kube-dns.kube-system.svc.k8s.org</span><br><span class="line">Address: 10.98.0.10</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run d1 --rm -it --image=quay.io/cloudwalker/alpine</span><br><span class="line">/ # ping svc-cluster</span><br><span class="line">PING svc-cluster (10.98.0.174): 56 data bytes</span><br><span class="line">ping: permission denied (are you root?)</span><br><span class="line"></span><br><span class="line">/ # ping svc-headless</span><br><span class="line">PING svc-headless (10.244.1.6): 56 data bytes</span><br><span class="line">ping: permission denied (are you root?)</span><br><span class="line"></span><br><span class="line">/ # ping svc-headless</span><br><span class="line">PING svc-headless (10.244.2.10): 56 data bytes</span><br><span class="line">ping: permission denied (are you root?)</span><br><span class="line"></span><br><span class="line">/ # ping svc-headless</span><br><span class="line">PING svc-headless (10.244.1.6): 56 data bytes</span><br><span class="line">ping: permission denied (are you root?)</span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>

<ul>
<li>為何只打 <code>ping svc-cluster</code> 名稱就能解析出 IP 位址 ?</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run d1 --rm -it --image=quay.io/cloudwalker/alpine</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">/ # cat /etc/resolv.conf</span><br><span class="line">search default.svc.k8s.org svc.k8s.org k8s.org mcu.edu.tw</span><br><span class="line">nameserver 10.98.0.10</span><br><span class="line">options ndots:5</span><br></pre></td></tr></table></figure>

<ul>
<li>因為 <code>search default.svc.k8s.org svc.k8s.org k8s.org mcu.edu.tw</code> <ul>
<li>這行表示我們在 <code>ping svc-cluster</code> 時，會自動幫我們在名稱後面加上 search 後面的字串做收尋，如 : <code>ping svc-cluster.default.svc.k8s.org</code> 找不到時，會在換後面的字串 <code>ping svc-cluster.svc.k8s.org</code> 做收尋，依此類推，一直到最後一個字串，如果都沒有就表示無法解析</li>
</ul>
</li>
</ul>
<p><strong>建立 POD 之間的 DNS 名稱解析</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ nano ~/wulin/yaml/svcfqdn.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: dt</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    name: busybox</span><br><span class="line">  clusterIP: None</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f  ~/wulin/yaml/svcfqdn.yaml </span><br><span class="line">service/dt created</span><br><span class="line"></span><br><span class="line">$ kubectl get svc dt</span><br><span class="line">NAME   TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">dt        ClusterIP   None           &lt;none&gt;          &lt;none&gt;    23s</span><br></pre></td></tr></table></figure>

<p><strong>新增 Pod 的搜尋網域名</strong></p>
<p>透過 <code>nano ~/wulin/yaml/podfqdn.yaml</code> 來編輯 yaml 檔</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">b1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">b1</span></span><br><span class="line">  <span class="attr">subdomain:</span> <span class="string">dt</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">quay.io/cloudwalker/alpine</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3600&quot;</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">capabilities:</span></span><br><span class="line">        <span class="attr">add:</span> [<span class="string">&quot;CAP_NET_RAW&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">b2</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">b2</span></span><br><span class="line">  <span class="attr">subdomain:</span> <span class="string">dt</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">quay.io/cloudwalker/alpine</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3600&quot;</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">capabilities:</span></span><br><span class="line">        <span class="attr">add:</span> [<span class="string">&quot;CAP_NET_RAW&quot;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li><pre><code>spec:
hostname: b1
subdomain: dt
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    - subdomain ，可以讓我們在 ping 的時候，在 pod 的名字後面 + `dt` ，就能被解析</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash!</span><br><span class="line">$ kubectl apply -f ~/wulin/yaml/podfqdn.yaml </span><br><span class="line"></span><br><span class="line">$ kubectl exec -it b2 -- sh</span><br><span class="line">/ # ping -c 1 b1.dt.default.svc.k8s.org</span><br><span class="line">PING b1.dt.default.svc.k8s.org (10.244.2.8): 56 data bytes</span><br><span class="line">.........</span><br><span class="line"></span><br><span class="line"># 可解析簡易名稱</span><br><span class="line">/ # ping -c 1 b1.dt</span><br><span class="line">PING b1.dt (10.244.2.8): 56 data bytes</span><br><span class="line">.........</span><br><span class="line"></span><br><span class="line">/ # apk add nano; nano /etc/resolv.conf</span><br><span class="line">search  dt.default.svc.k8s.org default.svc.k8s.org svc.k8s.org localdomain</span><br><span class="line">nameserver 10.98.0.10</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line">/ # ping -c 1 b1</span><br><span class="line">PING b1 (10.244.2.8): 56 data bytes</span><br><span class="line">.........</span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="新增-Pod-的搜尋網域名"><a href="#新增-Pod-的搜尋網域名" class="headerlink" title="新增 Pod 的搜尋網域名"></a>新增 Pod 的搜尋網域名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete -f ~/wulin/yaml/podfqdn.yaml</span><br><span class="line"></span><br><span class="line">$ nano ~/wulin/yaml/podfqdn.yaml</span><br><span class="line">..............</span><br><span class="line">spec:</span><br><span class="line">  hostname: b2</span><br><span class="line">  subdomain: dt</span><br><span class="line">  containers:</span><br><span class="line">  - image: quay.io/cloudwalker/alpine</span><br><span class="line">    imagePullPolicy: Always</span><br><span class="line">    command:</span><br><span class="line">      - sleep</span><br><span class="line">      - &quot;3600&quot;</span><br><span class="line">    name: busybox</span><br><span class="line">    securityContext:</span><br><span class="line">      capabilities:</span><br><span class="line">        add: [&quot;CAP_NET_RAW&quot;]</span><br><span class="line">  dnsConfig:</span><br><span class="line">    searches:</span><br><span class="line">    - dt.default.svc.k8s.org</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f ~/wulin/yaml/podfqdn.yaml </span><br><span class="line"></span><br><span class="line">$ kubectl exec -it b2 -- sh</span><br><span class="line">/ # cat /etc/resolv.conf</span><br><span class="line">search default.svc.k8s.org svc.k8s.org k8s.org localdomain dt.default.svc.k8s.org</span><br><span class="line">nameserver 10.98.0.10</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line">/ # ping -c 1 b1</span><br><span class="line">PING b1 (10.244.2.3): 56 data bytes</span><br><span class="line">64 bytes from 10.244.2.3: seq=0 ttl=62 time=0.590 ms</span><br><span class="line"></span><br><span class="line">--- b1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.590/0.590/0.590 ms</span><br><span class="line"></span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>



<h2 id="佈署-Kubernetes-Job-Controller"><a href="#佈署-Kubernetes-Job-Controller" class="headerlink" title="佈署 Kubernetes Job Controller"></a>佈署 Kubernetes Job Controller</h2><p>建立 Kubernetes Job Controller</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;apiVersion: batch/v1</span><br><span class="line">kind: Job</span><br><span class="line">metadata:</span><br><span class="line">  name: job1</span><br><span class="line">spec:</span><br><span class="line">  template:</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: job</span><br><span class="line">          image: quay.io/cloudwalker/busybox</span><br><span class="line">          args:</span><br><span class="line">            - /bin/sh</span><br><span class="line">            - -c</span><br><span class="line">            - date; echo sleeping....; sleep 30s; echo exiting...; date</span><br><span class="line">      restartPolicy: Never &#x27; &gt;  ~/wulin/yaml/job01.yaml</span><br><span class="line"></span><br><span class="line">$ ka -f yaml/job01.yaml</span><br><span class="line"></span><br><span class="line">$ kg job</span><br><span class="line">NAME   COMPLETIONS   DURATION   AGE</span><br><span class="line">job1   1/1           44s        5m26s</span><br><span class="line"></span><br><span class="line">$ kubectl get pod -l=job-name=job1</span><br><span class="line">NAME         READY   STATUS      RESTARTS   AGE</span><br><span class="line">job1-9b8xz   0/1     Completed   0          119m</span><br></pre></td></tr></table></figure>


<p>修改 yaml 檔</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">job1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">job</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">quay.io/cloudwalker/busybox</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">date;</span> <span class="string">echo</span> <span class="string">sleeping....;</span> <span class="string">sleep</span> <span class="string">30s;</span> <span class="string">echo</span> <span class="string">exiting...;</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>

<p>apply 它</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ka -f yaml/job01.yaml</span><br><span class="line">The Job &quot;job1&quot; is invalid: spec.template.spec.restartPolicy: Required value: valid values: &quot;OnFailure&quot;, &quot;Never&quot;</span><br></pre></td></tr></table></figure>

<p>檢視 Kubernetes Job Controller</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;apiVersion: batch/v1</span><br><span class="line">kind: Job</span><br><span class="line">metadata:</span><br><span class="line">  name: job2</span><br><span class="line">spec:</span><br><span class="line">  activeDeadlineSeconds: 5</span><br><span class="line">  template:</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: job2</span><br><span class="line">          image: busybox</span><br><span class="line">          args:</span><br><span class="line">            - /bin/sh</span><br><span class="line">            - -c</span><br><span class="line">            - date; echo sleeping....; sleep 30s; echo exiting...; date</span><br><span class="line">      restartPolicy: Never &#x27; &gt;  ~/wulin/yaml/job02.yaml</span><br><span class="line"></span><br><span class="line">$ ka -f yaml/job02.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li><code>activeDeadlineSeconds: 5</code> ，設定 Job 只能跑 5  秒，時間到會停止</li>
</ul>
<h6 id="tags-系統工程"><a href="#tags-系統工程" class="headerlink" title="tags: 系統工程"></a>tags: <code>系統工程</code></h6>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%B3%BB%E7%B5%B1%E5%B7%A5%E7%A8%8B/" rel="tag"># 系統工程</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Kubernetes%20yaml%20%E6%AA%94%E8%BC%94%E5%8A%A9%E5%99%A8/" rel="prev" title="Kubernetes yaml 檔輔助器">
      <i class="fa fa-chevron-left"></i> Kubernetes yaml 檔輔助器
    </a></div>
      <div class="post-nav-item">
    <a href="/Kubernetes%20CRI%20%E5%9F%BA%E7%A4%8E%E9%81%8B%E4%BD%9C/" rel="next" title="Kubernetes CRI 基礎運作">
      Kubernetes CRI 基礎運作 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Kubernetes-Objects"><span class="nav-number">1.</span> <span class="nav-text">Kubernetes-Objects</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AA%8D%E8%AD%98-K8S-%E5%8F%A2%E9%9B%86%E7%89%A9%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">認識 K8S 叢集物件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Object-Short-names"><span class="nav-number">1.2.</span> <span class="nav-text">K8S Object Short-names</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Kubernetes-POD"><span class="nav-number">2.</span> <span class="nav-text">建立 Kubernetes POD</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AA%8D%E8%AD%98-Kubernetes-Pod"><span class="nav-number">2.1.</span> <span class="nav-text">認識 Kubernetes Pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Single-Container-Pod-%E5%BB%BA%E7%AB%8B%E8%88%87%E9%80%A3%E6%8E%A5"><span class="nav-number">2.2.</span> <span class="nav-text">Single Container Pod 建立與連接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Single-Container-Pod-%E8%87%AA%E5%8B%95%E9%87%8D%E6%96%B0%E5%BB%BA%E7%AB%8B"><span class="nav-number">2.3.</span> <span class="nav-text">Single Container Pod 自動重新建立</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Node-%E7%B3%BB%E7%B5%B1%E9%87%8D%E6%96%B0%E5%95%9F%E5%8B%95"><span class="nav-number">2.4.</span> <span class="nav-text">K8S Node 系統重新啟動</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Single-Container-Pod-%E6%B0%B8%E4%B8%8D%E9%87%8D%E5%95%9F"><span class="nav-number">2.5.</span> <span class="nav-text">Single Container Pod 永不重啟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Share-PID-Namespace-Pod"><span class="nav-number">2.6.</span> <span class="nav-text">建立 Share PID Namespace Pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AA%A2%E8%A6%96-Pod-%E5%85%A7%E9%83%A8%E8%B3%87%E8%A8%8A"><span class="nav-number">2.7.</span> <span class="nav-text">檢視 Pod 內部資訊</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AA%A2%E6%B8%AC-Pod-%E5%85%A7%E9%83%A8-Process"><span class="nav-number">2.8.</span> <span class="nav-text">檢測 Pod 內部 Process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A-POD-%E8%A8%AD%E5%AE%9A"><span class="nav-number">2.9.</span> <span class="nav-text">更多 POD 設定</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DNS-for-Service"><span class="nav-number">3.</span> <span class="nav-text">DNS for Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E-Pod-%E7%9A%84%E6%90%9C%E5%B0%8B%E7%B6%B2%E5%9F%9F%E5%90%8D"><span class="nav-number">3.0.1.</span> <span class="nav-text">新增 Pod 的搜尋網域名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%88%E7%BD%B2-Kubernetes-Job-Controller"><span class="nav-number">3.1.</span> <span class="nav-text">佈署 Kubernetes Job Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#tags-%E7%B3%BB%E7%B5%B1%E5%B7%A5%E7%A8%8B"><span class="nav-number">3.1.0.0.0.1.</span> <span class="nav-text">tags: 系統工程</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Antony Cehn</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Antony.Chen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
